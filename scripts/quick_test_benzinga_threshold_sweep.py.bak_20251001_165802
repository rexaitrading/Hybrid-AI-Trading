from hybrid_ai_trading.data.clients.benzinga_client import BenzingaClient
from hybrid_ai_trading.risk.sentiment_filter import SentimentFilter

# Fetch latest headlines (AAPL + TSLA as liquid symbols)
c = BenzingaClient()
stories = c.get_news("AAPL,TSLA", limit=15)

# Candidate parameter sets to test
param_sets = [
    {"threshold": 0.60, "neutral_zone": 0.25},
    {"threshold": 0.65, "neutral_zone": 0.25},
    {"threshold": 0.70, "neutral_zone": 0.20},  # your current config
]

print("\n=== Sentiment Filter Parameter Sweep ===\n")

for params in param_sets:
    f = SentimentFilter(model="vader", threshold=params["threshold"], neutral_zone=params["neutral_zone"], smoothing=3)
    allowed_count = 0
    blocked_count = 0

    print(f"\n--- Config: threshold={params['threshold']} | neutral_zone={params['neutral_zone']} ---")
    for s in stories:
        headline = s.get("title","")
        sc = f.score(headline)
        allowed = f.allow_trade(headline, side="BUY")
        if allowed:
            allowed_count += 1
            status = "ALLOW "
        else:
            blocked_count += 1
            status = "BLOCK "
        print(f"[{s.get('created')}] {headline} | Score={sc:.2f} | {status}")

    total = allowed_count + blocked_count
    pct_allowed = (allowed_count / total * 100) if total > 0 else 0
    print(f"\nSummary: Allowed={allowed_count}, Blocked={blocked_count}, Allowed%={pct_allowed:.1f}%")

print("\n=== End of Sweep ===\n")
